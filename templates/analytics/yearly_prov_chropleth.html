<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fires Choropleth Map 2003</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; padding:0; }
    #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Initialize map
const map = L.map('map').setView([-19.0, 29.5], 6);

// Base layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Color scale
function getColor(count) {
  return count > 10000 ? '#800026' :
         count > 4500  ? '#BD0026' :
         count > 3000  ? '#E31A1C' :
         count > 1500  ? '#FC4E2A' :
         count > 500   ? '#FEB24C' :
         count > 0     ? '#FED976' :
                         '#FFFFFF';
}

// Load fire data for 2003
fetch('/api/fires/summary/province-year')
  .then(res => res.json())
  .then(result => {
    const fireData = result.data.filter(d => d.year === 2003);

    // Load GeoJSON
    fetch('/static/data/zim_admin1.geojson')
      .then(res => res.json())
      .then(geojson => {
        L.geoJSON(geojson, {
          style: feature => {
            const province = feature.properties.ADM1_EN;
            const record = fireData.find(d => d.province === province);
            const count = record ? record.fire_count : 0;
            return { fillColor: getColor(count), weight: 2, color: 'white', fillOpacity: 0.7 };
          }
        }).addTo(map);
      });
  });
</script>

</body>
</html>
