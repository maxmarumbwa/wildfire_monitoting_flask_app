<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fires per Province-Year</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .card { background: #fff; padding: 20px; border-radius: 8px; max-width: 1200px; margin: auto; }
    h2 { margin-bottom: 15px; }
    canvas { margin-top: 20px; }
  </style>
</head>
<body>

<div class="card">
  <h2>ðŸ”¥ Fires per Province-Year</h2>
  <canvas id="firesChart"></canvas>
</div>

<script>
fetch('/api/fires/summary/province-year')
  .then(res => res.json())
  .then(result => {
    const data = result.data;

    // Unique provinces and years
    const provinces = [...new Set(data.map(d => d.province))].sort();
    const years = [...new Set(data.map(d => d.year))].sort();

    // Create dataset for each year
    const datasets = years.map((year, i) => ({
      label: year,
      data: provinces.map(prov => {
        const record = data.find(d => d.province === prov && d.year === year);
        return record ? record.fire_count : 0;
      }),
      backgroundColor: `hsl(${i * 40 % 360}, 70%, 50%)`
    }));

    const ctx = document.getElementById('firesChart');

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: provinces,
        datasets: datasets
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top', onClick: (e, legendItem, legend) => {
            const index = legendItem.datasetIndex;
            const ci = legend.chart;
            ci.getDatasetMeta(index).hidden = !ci.getDatasetMeta(index).hidden;
            ci.update();
          } }
        },
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Fire Count' } },
          x: { title: { display: true, text: 'Province' } }
        }
      }
    });
  })
  .catch(err => console.error('Error loading fire data:', err));
</script>

</body>
</html>
