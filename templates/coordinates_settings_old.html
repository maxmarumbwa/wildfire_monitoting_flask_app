<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Coordinates Table with Name</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #eef2f7; }
        .container { width: 900px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table, th, td { border: 1px solid #aaa; }
        th, td { padding: 10px; text-align: center; }
        th { background: #1e90ff; color: white; }
        input { width: 90%; text-align: center; }
        button { margin-top: 10px; padding: 8px; cursor: pointer; }
        .btn-add { background: #28a745; color: white; border: none; }
        .btn-remove { background: #dc3545; color: white; border: none; }
        .btn-get { background: #1e90ff; color: white; border: none; width: 100%; font-size: 16px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Dynamic Coordinates Table with Name</h2>
    <p>Add/remove rows, set a name for each point, then click "Get Weather".</p>

    <table id="coordsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td><input type="text" value="Point 1"></td>
                <td><input type="number" step="0.0001" value="-15.0"></td>
                <td><input type="number" step="0.0001" value="27.0"></td>
                <td>
                    <button class="btn-add">+</button>
                    <button class="btn-remove">-</button>
                </td>
            </tr>
        </tbody>
    </table>

    <button id="getWeatherBtn" class="btn-get">Get Weather for All Points</button>

    <h3>Weather Results:</h3>
    <div id="resultsContainer">Weather data will appear here.</div>
</div>

<script>
const table = document.getElementById("coordsTable").getElementsByTagName("tbody")[0];

// Add/remove row
table.addEventListener("click", function(e){
    if(e.target.classList.contains("btn-add")){
        const rowCount = table.rows.length;
        const newRow = table.insertRow();
        newRow.innerHTML = `
            <td>${rowCount+1}</td>
            <td><input type="text" value="Point ${rowCount+1}"></td>
            <td><input type="number" step="0.0001" value="0.0"></td>
            <td><input type="number" step="0.0001" value="0.0"></td>
            <td>
                <button class="btn-add">+</button>
                <button class="btn-remove">-</button>
            </td>
        `;
    }
    if(e.target.classList.contains("btn-remove")){
        if(table.rows.length>1){
            e.target.closest("tr").remove();
            updateRowNumbers();
        } else alert("At least one row is required.");
    }
});

function updateRowNumbers(){
    Array.from(table.rows).forEach((row,i)=>{
        row.cells[0].textContent = i+1;
    });
}

// Fetch weather
document.getElementById("getWeatherBtn").addEventListener("click", function(){
    let coords = [];
    Array.from(table.rows).forEach(row=>{
        let name = row.cells[1].children[0].value;
        let lat = row.cells[2].children[0].value;
        let lon = row.cells[3].children[0].value;
        if(lat && lon) coords.push({name: name, lat: lat, lon: lon});
    });

    fetch("/get_weather_multi", {
        method:"POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({coords: coords})
    })
    .then(res=>res.json())
    .then(data=>renderResults(data))
    .catch(()=>document.getElementById("resultsContainer").innerHTML="Error fetching data.");
});

function renderResults(results){
    let html = `
    <table>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Location</th>
            <th>Weather</th>
            <th>Temp (Â°C)</th>
            <th>Humidity</th>
            <th>Wind (m/s)</th>
        </tr>
    `;
    results.forEach((item,index)=>{
        let d = item.data;
        let tempC = (d.main.temp - 273.15).toFixed(2);
        html += `
        <tr>
            <td>${index+1}</td>
            <td>${item.name || ""}</td>
            <td>${item.lat}</td>
            <td>${item.lon}</td>
            <td>${d.name || "Unknown"}, ${d.sys.country || ""}</td>
            <td>${d.weather[0].description}</td>
            <td>${tempC}</td>
            <td>${d.main.humidity}%</td>
            <td>${d.wind.speed}</td>
        </tr>
        `;
    });
    html += `</table>`;
    document.getElementById("resultsContainer").innerHTML = html;
}
</script>
</body>
</html>
